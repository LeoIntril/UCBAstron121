#Import necessary packages
import numpy as np
import ugradio

sdr = ugradio.sdr.SDR()

sdr.sample_rate = 2.4e6          # Hz
sdr.center_freq = 100e6          # tune to quiet band
sdr.gain = 20                    # fixed gain (recommended for noise)

#Define samples to collect
Nsamp = 20000                    # tens of thousands
samples = sdr.capture_data(Nsamp)

print(f"Captured {len(samples)} samples")

#Check sample statistics
I = np.real(samples)
Q = np.imag(samples)

print("I mean:", np.mean(I))
print("I variance:", np.var(I))
print("Q mean:", np.mean(Q))
print("Q variance:", np.var(Q))

np.savez(
    "sdr_capture.npz",
    samples=samples,
    I=I,
    Q=Q,
    sample_rate=sdr.sample_rate,
    center_freq=sdr.center_freq,
    gain=sdr.gain,
    Nsamp=Nsamp
)

#Due to time delay code below can act as a trial
import numpy as np
import ugradio
import time

sdr = ugradio.sdr.SDR()
sdr.sample_rate = 1.0e6
sdr.center_freq = 100e6
sdr.gain = 20

_ = sdr.capture_data(1000)
time.sleep(0.1)

samples = sdr.capture_data(20000)
print("Captured:", len(samples))

sdr.close()
print("Finished cleanly")
